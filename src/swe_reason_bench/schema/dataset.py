from dataclasses import dataclass
from typing import Any

from dataclasses_json import dataclass_json


@dataclass_json
@dataclass
class ResolvedIssue:
    """Schema for resolved issue instances."""

    number: int
    title: str
    body: str


@dataclass_json
@dataclass
class IssueResolvingTaskMetadata:
    """Schema for metadata instances."""

    problem_domains: list[str]
    difficulty: str


@dataclass_json
@dataclass
class IssueResolvingTaskInstance:
    """Schema for Issue Resolving task instances."""

    instance_id: str
    repo: str
    language: str
    pull_number: int
    title: str
    body: str
    created_at: str
    problem_statement: str
    hints_text: str
    resolved_issues: list[ResolvedIssue]
    base_commit: str
    patch: str
    test_patch: str
    env_setup_config: dict[str, Any]
    FAIL_TO_PASS: list[str]
    PASS_TO_PASS: list[str]
    version: str
    metadata: IssueResolvingTaskMetadata


@dataclass_json
@dataclass
class CodeReviewTaskMetadata:
    """Schema for code review metadata instances."""

    problem_domains: list[str]
    """List of the problem domains"""
    difficulty: str
    """The task difficulty of the pull request"""
    estimated_review_effort: int
    """The estimated review effort of the pull request between 1 and 5"""


@dataclass_json
@dataclass
class ReferenceReviewComment:
    """Schema for reference review comment instances."""

    body: str

    created_at: str
    updated_at: str
    path: str
    diff_hunk: str
    line: int
    start_line: int
    original_line: int
    original_start_line: int


@dataclass_json
@dataclass
class CommitToReview:
    """Schema for commit to review instances."""

    head_commit: str
    head_commit_message: str
    patch_to_review: str
    reference_review_comments: list[ReferenceReviewComment]


@dataclass_json
@dataclass
class CodeReviewTaskInstance:
    """Schema for Code Review task instances."""

    instance_id: str
    """A formatted instance identifier, usually as repo_owner__repo_name-PR-number:commit_sha_short"""
    repo: str
    """The repository owner/name identifier from GitHub"""
    language: str
    """The main programming language of the repo"""
    pull_number: int
    """Number of PR this task instance is from"""
    title: str
    """The PR title"""
    body: str
    """The PR body"""
    created_at: str
    """The creation date of the pull request"""
    problem_statement: str
    """The issue(s) title and body"""
    hints_text: str
    """Comments made on the issue(s) prior to the creation of the commit to review of the solution PR."""
    resolved_issues: list[ResolvedIssue]
    """The resolved issues of the pull request"""
    base_commit: str
    """The commit hash of the repository representing the HEAD of the repository before the solution PR is applied."""
    commit_to_review: CommitToReview
    """The commit to review of the pull request"""
    merged_commit: str
    """The merged commit of the pull request"""
    merged_patch: str
    """The gold patch, the patch generated by the PR, that resolved the issue"""
    metadata: CodeReviewTaskMetadata
